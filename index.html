<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ProTools — All‑in‑One Image & PDF Suite</title>
  <meta name="description" content="Photo→PDF, compress, convert, resize, rotate, EXIF remover, watermark, filters. Fast, responsive, dark mode, client‑side."/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    /* Base and theme tokens */
    :root{
      --bg: #0b0f16;
      --bg-2:#0f1624;
      --panel:#121a2a;
      --text:#e6eefc;
      --muted:#9db0d4;
      --stroke:rgba(255,255,255,.08);
      --brand:#6aa8ff;
      --brand-2:#76f7c9;
      --ok:#47d497;
      --warn:#ffb454;
      --err:#ff6b6b;
      --radius:14px;
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --blur: 12px;
      --accent: conic-gradient(from 90deg, var(--brand), var(--brand-2));
    }
    [data-theme="light"]{
      --bg:#f6f8fc; --bg-2:#eef2fb; --panel:#ffffff; --text:#0d1424; --muted:#4a5d84;
      --stroke:rgba(0,0,0,.07); --shadow:0 10px 30px rgba(0,0,0,.08);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font: 15px/1.6 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica Neue, Arial;
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 85% -20%, rgba(106,168,255,.22), transparent 60%),
        radial-gradient(900px 600px at -10% 10%, rgba(118,247,201,.18), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg-2) 50%, var(--bg));
      display:grid; grid-template-rows:auto 1fr; overflow-x:hidden;
    }

    /* Header */
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: saturate(1.2) blur(var(--blur));
      background: linear-gradient(180deg, rgba(0,0,0,.35), transparent);
      border-bottom:1px solid var(--stroke);
    }
    .bar{
      max-width:1200px; margin:0 auto; padding:14px 18px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.2px; font-size:18px;
    }
    .logo{width:34px;height:34px;border-radius:10px;background:var(--accent); box-shadow:0 8px 18px rgba(106,168,255,.35), inset 0 0 14px rgba(255,255,255,.2)}
    .searchbar{flex:1; max-width:460px; display:flex; gap:8px; align-items:center; background:rgba(255,255,255,.04); border:1px solid var(--stroke); padding:8px 10px; border-radius:12px}
    .searchbar input{flex:1; background:transparent; border:0; color:var(--text); outline:none}
    .actions{display:flex; gap:10px; align-items:center}
    .btn{
      appearance:none; border:1px solid var(--stroke); color:var(--text);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.15));
      padding:10px 14px; border-radius:12px; cursor:pointer;
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease;
      box-shadow:var(--shadow); white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn.primary{ border-color:transparent; background: linear-gradient(180deg, var(--brand), #3f7ef8); color:white }

    .toggle{ width:48px; height:30px; border-radius:999px; position:relative; border:1px solid var(--stroke); background:var(--panel); cursor:pointer}
    .toggle .dot{ position:absolute; top:3px; left:3px; width:24px; height:24px; border-radius:50%; background:linear-gradient(180deg,#fff,#dbe6ff); transition:left .2s; box-shadow:0 6px 16px rgba(0,0,0,.25)}
    [data-theme="light"] .toggle .dot{ left:21px }

    /* Layout */
    main{ max-width:1200px; margin:18px auto; padding:0 16px; display:grid; grid-template-columns:260px 1fr; gap:16px }
    @media (max-width: 980px){ main{ grid-template-columns:1fr } }

    /* Sidebar */
    nav{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.18));
      border:1px solid var(--stroke); border-radius:14px; padding:14px; box-shadow:var(--shadow);
      position:sticky; top:72px; align-self:start;
    }
    .nav-title{ margin:0 6px 10px; font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.7px }
    .tool{
      display:flex; align-items:center; gap:10px; padding:10px 12px; margin:6px 0; border-radius:10px;
      cursor:pointer; border:1px solid transparent; transition: background .15s ease, border-color .15s ease, transform .08s ease;
      outline:none;
    }
    .tool:hover{ transform: translateX(2px) }
    .tool[aria-current="page"], .tool:focus-visible{
      background: linear-gradient(180deg, rgba(106,168,255,.18), rgba(118,247,201,.12));
      border-color: rgba(255,255,255,.12);
    }
    .tool .icon{ width:22px; height:22px; border-radius:6px; background: radial-gradient(circle at 30% 30%, #fff6, transparent 60%), var(--accent) }

    /* Panel */
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.18));
      border:1px solid var(--stroke); border-radius:14px; box-shadow:var(--shadow); padding:20px; overflow:hidden;
    }
    h1{ margin:4px 0 8px; font-size:24px }
    p.sub{ color:var(--muted); margin-top:0 }

    .dropzone{
      border:2px dashed rgba(255,255,255,.18); border-radius:16px; padding:24px; text-align:center; cursor:pointer;
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.18));
      transition:border-color .15s ease, background .15s ease;
    }
    .dropzone.drag{ border-color:var(--brand); background: rgba(106,168,255,.1) }
    .hint{ font-size:13px; color:var(--muted) }

    .controls{ display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); margin-top:14px }
    .field{ display:grid; gap:6px }
    .label{ font-size:12px; color:var(--muted) }
    input[type="number"], select, input[type="text"], input[type="range"]{
      padding:10px 12px; border-radius:10px; border:1px solid var(--stroke); background:var(--panel); color:var(--text);
      accent-color: var(--brand);
    }

    .grid{ display:grid; gap:12px; grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); margin-top:14px }
    .card{ border:1px solid var(--stroke); border-radius:12px; overflow:hidden; background:rgba(0,0,0,.15); animation: fadeIn .25s ease both }
    .thumb{ width:100%; aspect-ratio: 4/3; object-fit:cover; display:block; background:#0a0f18 }
    .meta{ padding:10px; display:grid; gap:6px }
    .small{ font-size:12px; color:var(--muted) }
    .row{ display:flex; gap:8px; flex-wrap:wrap }
    .pill{ font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--stroke); background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.15)); color:var(--text); cursor:pointer }
    .pill:hover{ filter:brightness(1.1) }

    .footer{ margin-top:16px; display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; align-items:center }
    .status{ padding:6px 10px; border-radius:10px; border:1px solid var(--stroke); color:var(--muted) }
    .right{ display:flex; gap:10px; flex-wrap:wrap }

    .toast{
      position:fixed; bottom:18px; left:50%; transform:translateX(-50%) translateY(20px);
      background: var(--panel); border:1px solid var(--stroke); color:var(--text);
      padding:10px 14px; border-radius:12px; box-shadow:var(--shadow); opacity:0; pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
    }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(0) }

    .ok{ color:var(--ok) } .warn{ color:var(--warn) } .err{ color:var(--err) }

    @keyframes fadeIn{ from{opacity:.0; transform: translateY(6px)} to{opacity:1; transform:none} }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
  </style>
</head>
<body>
  <header>
    <div class="bar" role="banner">
      <div class="brand"><div class="logo" aria-hidden="true"></div><div>ProTools</div></div>
      <div class="searchbar" role="search">
        <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.2-4.2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/></svg>
        <input id="search" placeholder="Search tools (e.g., compress, pdf, resize)"/>
      </div>
      <div class="actions">
        <button class="btn" id="clearAll" title="Clear everything">Reset</button>
        <button class="btn primary" id="downloadAll" title="Batch download results">Download All</button>
        <div class="toggle" id="themeToggle" role="switch" aria-checked="false" aria-label="Toggle theme"><div class="dot"></div></div>
      </div>
    </div>
  </header>

  <main>
    <nav aria-label="Tools navigation">
      <div class="nav-title">Tools</div>
      <div id="navList"></div>
    </nav>

    <section class="panel" id="content" aria-live="polite">
      <h1 id="title">Tools</h1>
      <p class="sub" id="subtitle">Drop your images or click the area below to get started.</p>

      <label for="fileInput" class="dropzone" id="dropzone">
        <input class="sr-only" type="file" id="fileInput" accept="image/*" multiple/>
        <div><strong>Click to select</strong> or drag & drop images here</div>
        <div class="hint">Supported: JPG, PNG, WEBP, GIF (first frame). All processing happens in your browser.</div>
      </label>

      <div class="controls" id="controls"></div>
      <div class="grid" id="preview"></div>

      <div class="footer">
        <div class="status" id="statusPill">No files yet</div>
        <div class="right">
          <button class="btn" id="reorder" title="Sort by name">Sort A→Z</button>
          <button class="btn" id="removeAll" title="Remove files">Remove All</button>
          <button class="btn primary" id="actionBtn">Run</button>
        </div>
      </div>
    </section>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Persistent theme
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.setAttribute('aria-checked', savedTheme === 'light');
    themeToggle.addEventListener('click', () => {
      const next = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', next);
      themeToggle.setAttribute('aria-checked', next === 'light');
      localStorage.setItem('theme', next);
      toast(`Theme: ${next}`);
    });

    // State
    const state = { active:'pdf', files:[], outputs:[] };

    // Elements
    const navList = document.getElementById('navList');
    const title = document.getElementById('title');
    const subtitle = document.getElementById('subtitle');
    const drop = document.getElementById('dropzone');
    const input = document.getElementById('fileInput');
    const controls = document.getElementById('controls');
    const preview = document.getElementById('preview');
    const statusPill = document.getElementById('statusPill');
    const actionBtn = document.getElementById('actionBtn');
    const reorderBtn = document.getElementById('reorder');
    const clearBtn = document.getElementById('clearAll');
    const removeAllBtn = document.getElementById('removeAll');
    const downloadAllBtn = document.getElementById('downloadAll');
    const search = document.getElementById('search');

    // Utility
    const bytes = (n)=> n<1024? n+' B' : n<1024*1024? (n/1024).toFixed(1)+' KB' : (n/1024/1024).toFixed(2)+' MB';
    const toastEl = document.getElementById('toast');
    function toast(msg, cls){
      toastEl.textContent = msg;
      toastEl.classList.remove('ok','warn','err','show');
      if (cls) toastEl.classList.add(cls);
      requestAnimationFrame(()=> {
        toastEl.classList.add('show');
        setTimeout(()=> toastEl.classList.remove('show'), 1600);
      });
    }
    function el(tag, attrs={}, children=[]){
      const e = document.createElement(tag);
      if (Array.isArray(attrs) || typeof attrs === 'string') { children = attrs; attrs = {}; }
      Object.entries(attrs).forEach(([k,v])=>{
        if (k === 'class') e.className = v;
        else if (k === 'dataset') Object.entries(v).forEach(([dk,dv])=> e.dataset[dk]=dv);
        else if (k.startsWith('on')) e.addEventListener(k.slice(2), v);
        else e.setAttribute(k, v);
      });
      (Array.isArray(children)?children:[children]).filter(Boolean).forEach(c=> e.append(c.nodeType?c:document.createTextNode(c)));
      return e;
    }
    function pillBtn(text, fn){ const b = el('button',{class:'pill', onclick:fn}, text); return b; }
    function loadImage(src){ return new Promise((res, rej)=> { const img = new Image(); img.onload = ()=>res(img); img.onerror = rej; img.src = src; }); }
    function blobToDataURL(blob){ return new Promise(res=> { const r = new FileReader(); r.onload = ()=>res(r.result); r.readAsDataURL(blob); }); }
    function triggerDownload(blob, name){ const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = name; a.click(); setTimeout(()=> URL.revokeObjectURL(a.href), 1500); }
    function rename(name, suffix, newExt){
      const i = name.lastIndexOf('.');
      const base = i>0 ? name.slice(0,i) : name;
      return `${base}${suffix}.${newExt}`;
    }
    function drawToCanvas(img, w, h, type='image/jpeg', quality=0.92, rotateDeg=0, filterCSS='none'){
      const c = document.createElement('canvas'); const ctx = c.getContext('2d');
      // Handle rotation by swapping width/height for 90/270
      const rot = ((rotateDeg%360)+360)%360;
      if (rot === 90 || rot === 270){ c.width = h; c.height = w; }
      else { c.width = w; c.height = h; }
      ctx.save();
      // Apply rotation transform
      if (rot === 90){ ctx.translate(c.width,0); ctx.rotate(Math.PI/2); }
      else if (rot === 180){ ctx.translate(c.width,c.height); ctx.rotate(Math.PI); }
      else if (rot === 270){ ctx.translate(0,c.height); ctx.rotate(3*Math.PI/2); }
      // Apply filters
      ctx.filter = filterCSS;
      ctx.drawImage(img, 0, 0, w, h);
      ctx.restore();
      return new Promise(res => c.toBlob(b=>res(b), type, quality));
    }

    // Tools registry
    const tools = {
      pdf: {
        label: 'Photo → PDF',
        desc: 'Combine multiple images into a single PDF. Reorder, margins, and auto orientation.',
        build(){
          const size = el('select', [el('option',{value:'a4'},'A4'), el('option',{value:'letter'},'Letter'), el('option',{value:'legal'},'Legal'), el('option',{value:'a3'},'A3')]);
          const margin = el('input',{type:'number', min:'0', value:'10'});
          const orient = el('select', [el('option',{value:'auto'},'Auto'), el('option',{value:'portrait'},'Portrait'), el('option',{value:'landscape'},'Landscape')]);
          controls.append(el('div',{class:'field'},[el('div',{class:'label'},'Page size'), size]));
          controls.append(el('div',{class:'field'},[el('div',{class:'label'},'Margins (mm)'), margin]));
          controls.append(el('div',{class:'field'},[el('div',{class:'label'},'Orientation'), orient]));
          this.cfg = { size, margin, orient };
          actionBtn.textContent = 'Export PDF';
        },
        async run(){
          const { jsPDF } = window.jspdf;
          const first = state.files[0];
          let orientation = 'portrait';
          const sel = (this.cfg.orient.value);
          if (sel === 'landscape') orientation='landscape';
          if (sel === 'auto') orientation = (first.width >= first.height) ? 'landscape' : 'portrait';
          const doc = new jsPDF({ orientation, unit:'mm', format: this.cfg.size.value });
          const m = Math.max(0, parseInt(this.cfg.margin.value||'10',10));
          const pageW = doc.internal.pageSize.getWidth();
          const pageH = doc.internal.pageSize.getHeight();
          for (let i=0;i<state.files.length;i++){
            const f = state.files[i];
            if (i>0) doc.addPage();
            const usableW = pageW - m*2, usableH = pageH - m*2;
            const imgAR = f.width / f.height, pageAR = usableW / usableH;
            let w,h; if (imgAR > pageAR){ w=usableW; h=w/imgAR } else { h=usableH; w=h*imgAR }
            const x=(pageW-w)/2, y=(pageH-h)/2;
            const tmp = await drawToCanvas(f.img, Math.round(w*4), Math.round(h*4), 'image/jpeg', .92);
            const dataUrl = await blobToDataURL(tmp);
            doc.addImage(dataUrl, 'JPEG', x, y, w, h, undefined, 'FAST');
          }
          const pdfBlob = doc.output('blob');
          const name = `merged-${Date.now()}.pdf`;
          state.outputs = [{blob:pdfBlob, name}];
          triggerDownload(pdfBlob, name);
          toast('PDF exported','ok');
        }
      },
      compress: {
        label:'Compressor',
        desc:'Reduce file size with adjustable quality. Preview and batch download.',
        build(){
          const q = el('input',{type:'range',min:'10',max:'100',value:'75', oninput: e=> qVal.textContent = `Quality: ${q.value}%`});
          const qVal = el('div',{class:'pill'}, `Quality: ${q.value}%`);
          controls.append(el('div',{class:'field'},[el('div',{class:'label'},'JPEG/WebP Quality'), q]), qVal);
          this.cfg = { q, qVal };
          actionBtn.textContent = 'Compress images';
        },
        async run(){
          const q = (parseInt(this.cfg.q.value,10) || 75)/100;
          state.outputs = [];
          for (const f of state.files){
            const blob = await drawToCanvas(f.img, f.width, f.height, 'image/jpeg', q);
            const name = rename(f.name, '_compressed','jpg');
            state.outputs.push({blob,name}); triggerDownload(blob,name);
          }
          toast('Compression complete','ok');
        }
      },
      convert: {
        label:'Format converter',
        desc:'Convert between PNG, JPG, and WEBP. Keeps original size.',
        build(){
          const fmt = el('select',[['image/png','PNG'],['image/jpeg','JPG'],['image/webp','WEBP']].map(([v,t])=> el('option',{value:v},t)));
          controls.append(el('div',{class:'field'},[el('div',{class:'label'},'Target format'), fmt]));
          this.cfg = { fmt }; actionBtn.textContent = 'Convert images';
        },
        async run(){
          const fmt = this.cfg.fmt.value;
          const ext = fmt.split('/')[1].replace('jpeg','jpg');
          state.outputs = [];
          for (const f of state.files){
            const blob = await drawToCanvas(f.img, f.width, f.height, fmt, fmt.endsWith('jpeg')? .92:.95);
            const name = rename(f.name,'_converted', ext);
            state.outputs.push({blob,name}); triggerDownload(blob,name);
          }
          toast('Conversion complete','ok');
        }
      },
      resize: {
        label:'Image resizer',
        desc:'Resize by width/height with optional aspect lock.',
        build(){
          const w = el('input',{type:'number',min:'1',placeholder:'Width (px)'});
          const h = el('input',{type:'number',min:'1',placeholder:'Height (px)'});
          const lock = el('input',{type:'checkbox',checked:true});
          const lockLbl = el('div',{class:'label'}, [lock, document.createTextNode(' Lock aspect ratio')]);
          controls.append(el('div',{class:'field'},[el('div',{class:'label'},'Width'), w]));
          controls.append(el('div',{class:'field'},[el('div',{class:'label'},'Height'), h]));
          controls.append(lockLbl);
          this.cfg = { w, h, lock }; actionBtn.textContent='Resize images';
        },
        as
